* 概要
    * このドキュメントは、HTTPを介してリモートでJava Cardアプリケーション（Java Cardアプレット）を管理するためのプロトコルと手順を定義しています。
    * アプリケーションのインストール、更新、削除などの操作が含まれます。
* アーキテクチャ
    * システムは主に3つのコンポーネントで構成されています。
        1. カード（Java Card）
        2. カード受け入れデバイス（例えば、スマートフォンやPOS端末）
        3. そしてリモートアプリケーションプロバイダ（RAP）
    * RAPは、HTTPを介してカード受け入れデバイスと通信し、カード上のアプリケーションを管理します。
* プロトコル
    * RAPとカード受け入れデバイス間の通信は、HTTPを介して行われます。
    * RAPはHTTP POSTリクエストを使用してコマンドを送信し、カード受け入れデバイスはHTTPレスポンスを使用して結果を返します。
    * これらのリクエストとレスポンスは、特定の形式でエンコードされ、暗号化されることがあります。
* セキュリティ
    * 通信は、TLS（Transport Layer Security）またはSSL（Secure Sockets Layer）を使用して保護されます。これにより、通信の機密性と完全性が保証されます。また、RAPとカード間の信頼関係は、互いに共有された秘密鍵によって確立されます。
* 操作
    * ドキュメントは、アプリケーションのインストール、更新、削除などの各操作の詳細な手順を提供します。
    * これらの操作は、RAPが送信する一連のコマンドによって実行されます。

----

**「タグリスト（TLV '5C'）は単一のタグのみを含むべきです。」とはどういう意味ですか。**

「タグリスト（TLV '5C'）は単一のタグのみを含むべきです」というのは、GET DATAコマンドを使用して特定のSD（セキュリティドメイン）管理セッションパラメータを取得する際に、データフィールド内で指定するTLV（タグ-長さ-値）形式のタグリストが、一度に一つのパラメータのみを指定するべきであるという意味です。つまり、このタグリストには複数のタグを含めるのではなく、取得したい単一のパラメータに対応する一つのタグのみを含める必要があります。これにより、カードは要求された特定のパラメータのみを応答として返すことができます。

**TAG:’A5’を使ったAPDUコマンドを作ってみてくれませんか。**

'A5' タグを使用したAPDUコマンドを作成するには、コマンドの構造を理解する必要があります。APDUコマンドは通常、以下のコンポーネントで構成されます：

- CLA（クラスバイト）
- INS（命令バイト）
- P1, P2（パラメータバイト）
- Lc（データフィールドの長さを示すバイト）
- Data（データフィールド）
- Le（期待される応答の長さを示すバイト）

'A5' タグを使用してSD管理セッションパラメータを更新するためのSTORE DATAコマンドは、TLV形式でデータを含む必要があります。以下は、特定のパラメータを更新するためのサンプルAPDUコマンドです：

```
CLA: 80 (GlobalPlatform命令を示す)
INS: E2 (STORE DATA命令を示す)
P1: 80 (最後のコマンドを示す)
P2: 00 (特に指定されたP2パラメータがない場合)
Lc: (データフィールドの長さを示すバイト数、以下のデータフィールドの長さに基づいて計算される)
Data: A5 (タグ)
      XX (タグ'A5'に続くデータの長さを示す、1バイトまたは2バイトの長さ)
      ... (タグ'A5'に関連するデータ)
Le: (省略可能、応答データの期待される長さを示す)
```

例えば、セキュリティドメインの特定のパラメータを更新するために、タグ'A5'に続くデータが'01 02 03 04'であるとします。この場合、Lcはデータの長さを含むため、'05'（タグ'A5' + 4バイトのデータ）になります。以下はそのAPDUコマンドの例です：

80 E2 80 00 07 A5 04 01 02 03 04

このコマンドは、タグ'A5'を持つSD管理セッションパラメータを更新し、そのパラメータのデータとして'01 02 03 04'を設定します。Leは省略されているため、カードからの応答データの長さについては特に期待していません。もし応答データの長さが必要な場合は、Leを適切な値に設定してください。


**'A5' タグを使用して '84' タグのRAS Connection Parametersを取得するためのGET DATAコマンドを作成するには、以下の形式に従います：**

- CLA: 通常は 80 (GlobalPlatform命令を示す)
- INS: CA (GET DATA命令を示す)
- P1-P2: 00 A5 (SD管理セッションパラメータを指定)
- Lc: データフィールドの長さを示すバイト数
- Data: 5C (タグリストを示すタグ) に続いて、取得したいパラメータのタグ
- Le: 応答データの期待される最大長さ（省略可能）

以下は、'84' タグのRAS Connection Parametersを取得するためのAPDUコマンドの例です：

80 CA 00 A5 02 5C 84 00

このコマンドでは、CLAが 80、INSが CA であり、P1-P2が 00 A5 で設定されています。Lcは 02 で、これはデータフィールドの長さを示しています。データフィールドは 5C 84 で、これはタグリストTLVであり、取得したいパラメータのタグ '84' を含んでいます。最後の 00 はLeで、応答データの期待される最大長さを示していますが、ここでは任意の長さの応答を受け取るために 00 としています。もし特定の長さの応答が必要な場合は、Leを適切な値に設定してください。


**コマンドが成功しません。 P1-P2に、00-85 を指定し、 80 CA 00 85 00 を打つと成功します。P1-P2に 00-A5を指定してコマンドを成功させてほしい。**

6A80という応答は、APDUコマンドのデータフィールドが不正であることを示しています。この場合、'84'タグのRAS Connection Parametersを取得しようとしていますが、カードがこの操作をサポートしていないか、またはコマンドの形式がカードの期待する形式と一致していない可能性があります。

'A5'タグを使用して特定のSD管理セッションパラメータを取得するための正確なコマンドは、カードの仕様や設定によります。カードの仕様書を確認するか、カードの発行者に問い合わせて、正しいコマンド構造を確認してください。

80 CA 00 A5 03 5C 01 84 00

このコマンドでは、'5C'タグに続く長さが'01'となり、その後に取得したいパラメータのタグ'84'が続きます。これにより、カードは'84'タグのパラメータのみを返すように指示されます。ただし、これが成功するかどうかはカードの仕様に依存します。