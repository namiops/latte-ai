# IoTA python client.

This is a simple python library that allows to connect to IoTA services with credentials generated by iotactl.

## Running a script:

To test this library you can run it as a standalone script.
There are two ways to do it, first one is using environment variables, second is using parameters in the code.

### Running with environment variables
In `__main__`:
```
    client = IoTAClient(logger=logger) # ENV setup.
```

Execution:
```
CLIENT_ID=iota-client \
TENANT_NAME=<TENANT_NAME> \
GROUP_NAME=<GROUP_NAME> \
DEVICE_NAME=<YOUR_DEVICE> \
IOTA_CA_PEM_FILE=/home/$USER/.iota/${DEVICE_NAME}_ca.pem \
IOTA_CRT_PEM_FILE=/home/$USER/.iota/${DEVICE_NAME}_crt.pem \
IOTA_KEY_PEM_FILE=/home/$USER/.iota/${DEVICE_NAME}_key.pem \
IOTA_BROKER_CREDENTIALS_JSON_FILE=/home/$USER/.iota/<CLUSTER>/<TENANT>/<GROUP>/${DEVICE_NAME}_broker.json \
IOTA_BROKER_HOST=iot.cityos-dev.woven-planet.tech \
IOTA_BROKER_PORT=8883 \
IDP_ENDPOINT=id.cityos-dev.woven-planet.tech \
PROVISION_SECRET=<GROUP_PROVISION_SECRET> \
DEPROVISION_SECRET_FILEPATH=/home/$USER/.iota/${DEVICE_NAME}_deprovisioning.txt \
python3 iota_client.py
```

Or via bazel:
```
CLIENT_ID=iota-client \
TENANT_NAME=<TENANT_NAME> \
GROUP_NAME=<GROUP_NAME> \
DEVICE_NAME=<YOUR_DEVICE> \
IOTA_CA_PEM_FILE=/home/$USER/.iota/${DEVICE_NAME}_ca.pem \
IOTA_CRT_PEM_FILE=/home/$USER/.iota/${DEVICE_NAME}_crt.pem \
IOTA_KEY_PEM_FILE=/home/$USER/.iota/${DEVICE_NAME}_key.pem \
IOTA_BROKER_CREDENTIALS_JSON_FILE=/home/$USER/.iota/<CLUSTER>/<TENANT>/<GROUP>/${DEVICE_NAME}_broker.json \
IOTA_BROKER_HOST=iot.cityos-dev.woven-planet.tech \
IOTA_BROKER_PORT=8883 \
IDP_ENDPOINT=id.cityos-dev.woven-planet.tech \
PROVISION_SECRET=<GROUP_PROVISION_SECRET> \
DEPROVISION_SECRET_FILEPATH=/home/$USER/.iota/${DEVICE_NAME}_deprovisioning.txt \
bazel run //ns/iot/demo/iota-client:run
```

### Running with parameters in the code
In `__main__`:
```
    user = os.getenv("USER")
    device = os.getenv("DEVICE_NAME")

    client = IoTAClient(
        logger=logger,
        endpoint="iot.cityos-dev.woven-planet.tech:8883",
        ca_filepath=f"/home/{user}/.iota/{device}_ca.pem",
        cert_filepath=f"/home/{user}/.iota/{device}_crt.pem",
        pri_key_filepath=f"/home/{user}/.iota/{device}_key.pem",
        broker_creds_filepath=f"/home/{user}/.iota/<cluster>/<tenant>/<group>/{device}_broker.json",

        client_id="iota-client",
        tenant=<TENANT_NAME>,   # change it to your tenant name
        group=<GROUP_NAME>,     # change it to your group name
        device=device,
        idp_endpoint="id.cityos-dev.woven-planet.tech", # change the endpoint if you are not using dev cluster
        provision_secret="<GROUP_PROVISION_SECRET>",    # change to provision secret of your group
        deprovision_secret_filepath=f"/home/{user}/.iota/{device}_deprovisioning.txt",
    )
```

Execution:
```
DEVICE_NAME=<YOUR_DEVICE> \
python3 iota_client.py
```

Or via bazel:
```
DEVICE_NAME=<YOUR_DEVICE> \
bazel run //ns/iot/demo/iota-client:run
```

You can see examples in `__main__` of `iota_client.py`.
