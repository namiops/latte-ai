# IoTAD + OTEL/Syslog Demo

This guide provides a simple demo showing how to use [IoTAD](https://developer.woven-city.toyota/docs/default/Component/iota-service/Tasks/iotad/) as a daemon (background service) utility to help with forwarding OTEL ([OpenTelemetry](https://opentelemetry.io/)) or Syslog messages generated by your iot device to the observability piplines through MQTT. 

## Preparations

Before getting started, please make sure [IoTAD](https://developer.woven-city.toyota/docs/default/Component/iota-service/Tasks/iotad/) is installed and the required configuration files are created and placed in the right place. For further details, please check [IoTAD](https://developer.woven-city.toyota/docs/default/Component/iota-service/Tasks/iotad/) page for details.

As implied by the name, IoTAD is intended to operate on the same machine as your application (i.e., the OTEL message generator). This machine could be a physical one, a Virtual Machine (VM), or a Container.

## IoTAD + OTEL

In our IoTAD + OTEL example, The IoTAD and [a sample OTEL generator binary](https://github.com/wp-wcm/city/tree/e5ec4bf8c32d566e7c140509f19d4563a283de82/ns/demo/otel-generator) have been inside an image. You can pull this demo image from our [Artifactory](https://artifactory-ha.tri-ad.tech/ui/repos/tree/General/docker/wcm-cityos/services/iotad-otel).

1. Navigate to [`iota-otel`](https://github.com/wp-wcm/city/tree/main/ns/iot/demo/iotad-observability/iotad-otel) folder.
2. Prepare your `.iota` folder with `iotad.json` inside.
3. Build the binaries and images.
   ```shell
   ./setup.sh
   ```
4. Start up the container.
   ```shell
    docker run -it iotad-otel
   ```
5. You should be able to observe iotad initiating the OTEL server at `127.0.0.1:4318` and starting to receive logs from the sample OTEL generator. Furthermore, these logs can also be found on our [observability platform](https://observability.cityos-dev.woven-planet.tech/grafana/dashboards/f/7rjGsypSz/serverless). We support telemetry in the formats of `logs`, `traces`, and `metrics`.
   
## IoTAD + Syslog

Similiarly, IoTAD also acts as a syslog server and it supports forwarding syslog messages to to the observability pipline. To do that, you simply need set up the syslog exporter's target address to be `127.0.0.1:1514`. For example, try below steps:
1. Get IoTAD up and running
   ```shell
   ./iotad
   ```
2. Use [Docker syslog logging driver](https://docs.docker.com/config/containers/logging/syslog/) to forward syslog to iotad's syslog server:
   ```shell
   docker run --log-driver syslog --log-opt syslog-address=udp://127.0.0.1:1514 alpine echo hello world
   ```
   > **⚠️ IMPORTANT NOTE:** We have found Docker syslog logging driver cannot forward syslogs properly on MacOS. So it's better to use Docker syslog logging driver in Linux machine
3. You will find the "hello world" syslog message has been collected by iotad and forwarded to our [obesevability platform](https://observability.cityos-dev.woven-planet.tech/grafana/dashboards/f/7rjGsypSz/serverless)
