# Bazel SonarQube integration

Analyse Bazel projects with SonarQube and tracks the `main` branch coverage data.

## Table of Contents
- [Bazel SonarQube integration](#bazel-sonarqube-integration)
  - [Table of Contents](#table-of-contents)
  - [Adding projects to SonarQube analysis](#adding-projects-to-sonarqube-analysis)
    - [sample rule for Golang](#sample-rule-for-golang)
    - [sample rule for Python](#sample-rule-for-python)
    - [sample rule for Java](#sample-rule-for-java)
  - [Language support for coverage reports](#language-support-for-coverage-reports)
  - [Access to SonarQube Dashboard](#access-to-sonarqube-dashboard)

## Adding projects to SonarQube analysis

SonarQube analysis can be enabled and configured by adding a `sonar-project.properties` file to your project's root directory. This file can be generated by adding the rule `load("//ns/bazel_sonarqube:defs.bzl", "sonar_project_properties")` in a Bazel BUILD file. Please refer to the samples in the next sections.

:warning: Do not define the property `sonar.projectKey`; Bazel automatically generates it.

:warning: Do not define the following properties as they are configured globally:

```
"sonar.host.url"
"sonar.coverageReportPaths"
"sonar.login"
"sonar.projectBaseDir"
"sonar.projectVersion"
"sonar.scm.url"
```

### sample rule for Golang

```starlark
load("//ns/bazel_sonarqube:defs.bzl", "sonar_project_properties")

sonar_project_properties(
    name = "my_properties",
    properties = {
        "sonar.coverage.exclusions": "**/*_test.go",
        "sonar.coverage.inclusions": "**/*.go",
        "sonar.language": "go",
        "sonar.projectDescription": <project description>,
        "sonar.projectName": <project name>,
    },
)
```

### sample rule for Python

```starlark
load("//ns/bazel_sonarqube:defs.bzl", "sonar_project_properties")

sonar_project_properties(
    name = "my_properties",
    properties = {
        "sonar.coverage.exclusions": "**/tests/**/*",
        "sonar.coverage.inclusions": "**/*.py",
        "sonar.language": "py",
        "sonar.projectDescription": <project description>,
        "sonar.projectName": <project name>,
    },
)
```

### sample rule for Java

```starlark
load("//ns/bazel_sonarqube:defs.bzl", "sonar_project_properties")

sonar_project_properties(
    name = "my_properties",
    properties = {
        # "sonar.java.binaries" points to the path of the compiled bytecode files.
        # Sonar Analysis for Java projects requires defining this property.
        # Use '.' to ignore.
        "sonar.java.binaries": ".",
        "sonar.language": "java",
        "sonar.projectDescription": <project description>,
        "sonar.projectName": <project name>,
        "sonar.sources": "main/",
        "sonar.tests": "test/",
    },
)
```

Open a pull request with the above changes. The auto-commit GitHub Action should generate and include a fresh `sonar-project.properties` with your changes. 

## Language support for coverage reports

Coverage data for the following languages is supported:

- Go
- Java
- Python

## Access to SonarQube Dashboard

To inspect your project, Visit Agora [SonarQube](https://sonarqube.agora-dev.w3n.io/) instance and select `Log in with GitHub`
