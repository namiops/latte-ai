# What is PDS

CityOS PDS - Personal Data Store - は、複数のCityOSサービスからアクセスされる可能性が高い、CityOSユーザーの個人データの一元的な保管場所です。PDSのデータは、事前に承認されたデータスキーマによって検証された、構造化されたJSONドキュメントとして保存されます。データはEncrypted-at-Restであり、暗号化されていないキー/IDバリューにはセキュリティ上、いかなるPII（個人情報）も含まれてはなりません。このデータは、サービスがユーザーデータにアクセスしてもらう際に、利用可能で信頼性の高い中心的なストレージとなることを意図しています。

この方法は、各サービスが別々にユーザー情報を保存する方法に比べて、いくつかの利点があります。

* セキュリティ - データが一元管理されているため、ユーザー情報、特に個人情報は暗号化されて保護されます。
* 一元化 - データを一元管理することで、データの断片化をある程度防ぐことができ、サービスがアクセスするデータも競合することなく、最新のデータを入手できる可能性が高くなります。

PDSは間接的に、DPS（Data Privacy Service）とプライバシーフローを通じて、きめ細かなパーミッションも提供しています。

## Basic Flow

![Basic Flow](./assets/pdsflow.png)

上記はすでにパーミッションが付与されていることを前提としています。

1. クライアント（サービスまたはアプリ）がCityOSのサービスに対してリクエストを送信します。
2. Ingress GatewayがTLSターミネーションを行います。
3. CityOS サービスに到達すると、適切な Auth トークンを STS から取得する必要があります。
4. CityOSのサービスがPDSにリクエストを出します。
5. PDSはKVS/DBでルックアップを実施します。
6. PDSはCityOSサービスにレスポンスを送信します。
7. CityOSサービスは、Ingress/API Gateway経由でレスポンスを返します。
8. ゲートウェイはクライアントにレスポンスを返します。

このフローの詳細については、[TN-0107](https://docs.google.com/document/d/1aZf0K0WRTNep-xcD4UOWkgM5J3MCZZObZDn3aGlPFDU/edit#)をご覧ください。

## What is DPS

データ・プライバシー・サービスでは、ユーザーの同意を得て管理しており、PDSに保存されているユーザーデータへのアクセスを希望するクライアントには、まずその許可を得ることが必要です。DPSに関しては、多くがこのチュートリアルの範囲外になります。DPSプロトタイプの詳細については、 [こちら](https://docs.google.com/document/d/1sbZ8_b-WKYN3GWFayefUFcAA8Po0YmUFTJM9ZbfJZWY/edit#heading=h.ni1wjiph8qvy)のテクニカルノートを参照ください。
