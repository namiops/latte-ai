# SpiceDB

## Temporary deployment in Agora cluster
([ticket for removing this temporary process](https://jira.tri-ad.tech/browse/CITYPF-2933))

Because of operator expecting secret with `datastore_uri` string and values for said string being accessible only in another secret generated by postgres operator temporarily we need to set manually some secret values for spice operator to deploy new spicedb instances without problems.

Sources:  
https://docs.authzed.com/spicedb/operator  
https://authzed.com/blog/open-source-spicedb-operator/

Steps:

1. Read `spicedb-psql-pguser-spicedb` secret values host, user, password
2. Build `datastore_uri` string with following format `postgres://$(user):$(password)@$(host):5432/spicedb?sslmode=disable` 
3. Generate password that will be used as a `preshared_key` and share it with the team
4. Edit `spicedb-config` secret and add `datastore_uri` and `preshared_key`